<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<html style="width: 100%;height: 810px;margin: 0px;padding: 0px;overflow-x: hidden;">
<head>
    <script type="text/javascript" src="//cloudfront.loggly.com/js/loggly.tracker-latest.min.js" async></script>
    <script>
        var _LTracker = _LTracker || [];
        _LTracker.push({'logglyKey': '83c6d341-b035-4b41-9e40-db52dfd7a7b8',
            'sendConsoleErrors' : false,
            'tag' : 'hermesLogs'});
    </script>

    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <link rel="stylesheet" type="text/css" href="../CSS/hermesStyle.css">

    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    <script src="https://cdn.rawgit.com/eligrey/canvas-toBlob.js/f1a01896135ab378aa5c0118eadd81da55e698d8/canvas-toBlob.js"></script>
    <script src="https://cdn.rawgit.com/eligrey/FileSaver.js/e9d941381475b5df8b7d7691013401e171014e89/FileSaver.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">

    <script src="../Library/jquery.twbsPagination.min.js"></script>
    <script src="../Library/colResizable-1.6.min.js"></script>
    <script src="../Library/log4javascript.js"></script>

</head>

<body onload="searchClicked(searchValue,typeValue)">

<div id="header1"></div>
<div id="overlay">
    <div class="loader"></div>
</div>

<div id="content">
    <table id="colResize" width="100%" border="0" cellpadding="0" cellspacing="0">
        <tr>
            <td id="graphArea" class="startSize">
                    <div>
                        <table>
                            <tr>
                                <td width="50px" ><a href="#" title="Export data" onclick="downloadGraphAsData(); return false;"><span class="glyphicon glyphicon-save-file" id="exportData_glyphicons"></span></a></td>
                                <td width="50px"><a href="#" title="Download svg" onclick="downloadGraphAsSVG(); return false;"><span class="glyphicon glyphicon-download-alt" id="exportSVG_glyphicons"></span></a></td>
                                <td width="50px"><a href="#" title="Clear" onclick="clearSVG();return false;"><img src="../Images/clearicon.png" id="clearSVG"></a></td>
                                <td width="650px">
                                    <div style=" margin-top:30px;margin-left: 180px;">
                                    <table>
                                        <tr>
                                            <td style="width: 100px;">
                                              <b>Total Nodes : </b>
                                            </td>
                                            <td style="width: 100px; color: green">
                                               <b id="totnodes"></b>
                                            </td>
                                            <td style="width: 100px;">
                                                <b>Total Edges : </b>
                                            </td>
                                            <td style="width: 100px; color: green">
                                                <b id="totedges"></b>
                                            </td>
                                        </tr>
                                    </table>
                                    </div>
                                </td>
                                <td width="250px"></td>
                                <td width="50px"><a href="#" title="adds all nodes to graph area" onclick=poplateClickedNode("",searchData,true)><span class="glyphicon glyphicon glyphicon-plus" id="enlarge_glyphicons"></span></a></td>
                            </tr>
                        </table>
                    </div>

                    <div>
                        <ul class="workspaceTab nav nav-tabs" role="tablist">
                            <li class="active"><a href="#tabArea0" data-toggle="tab" oncontextmenu="return showContextMenu(event,this);"> Default </a> <span> x </span></li>

                            <li><a href="#" class="add-tab">+</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane fade in active" id="tabArea0" style="overflow: auto; height: 540px;"></div>
                        </div>

                        <div >
                            <table class="slider">
                                <tr>
                                    <td style="width: 150px;">
                                        <p style=" margin-bottom: 30px; margin-left: 10px">Selected Year:</p>
                                    </td>
                                    <!-- <p>Selected year:<p id="selectedyear" style="color:green"></p></p>-->
                                    <td style="width: 120px">
                                        <p style="margin-bottom: 30px;" id="selectedyear"></p>
                                    </td>
                                    <td style="width:850px;">
                                        <form style="margin-left: 30px" class="range-field">
                                            <input id="sliderValue" type="range" value="1940" min="1940" max="2020" style="margin-bottom: 30px;"onchange="sliderMoved()"/>
                                        </form>
                                    </td>
                                    <td style="width: 280px;">
                                        <div class="checkbox" >
                                            <label style="margin-left: 40px;margin-bottom: 30px"><input id="sliderChkbox" onclick=enableSlider() type="checkbox" value="">Enable slider</label>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
            </td>
            <td id="searchArea">
                <ul class="nav nav-tabs" id="resultList">
                    <li class="active"><a data-toggle="tab" href="#ResultsArea" onclick="loadResults()">Results</a></li>

                    <li class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#" >Facets <span class="caret"></span> </a>
                        <ul class="dropdown-menu">
                            <li><a  data-toggle="tab" href="#FacetsArea" onclick="loadFacets(searchValue,true)"> by year</a></li>
                            <li><a data-toggle="tab" href="#FacetsArea" onclick="loadFacets(searchValue,false)"> by citation count</a></li>
                        </ul>
                    </li>
                </ul>
                <div class="tab-content">

                    <div class="tab-pane fade in active searchsize" id="ResultsArea" style="margin-left: 10px">
                        <table style="margin-left: 5px">
                            <tr>
                                <td>
                                    <input id="searchinput" class="scholarlySearch" autocomplete="off" type="search" onkeypress="submitIfEnter_scholarly(event)" onkeyup="fillSuggestion()" placeholder="type keyword(s) here" />
                                    <input id="hiddenInput" autocomplete="off" type="hidden">
                                </td>

                                <td>
                                    <button type="submit" id="searchRes" class="searchbtn" class="btn" onclick=searchClickedFromScholarly()> <span class='glyphicon glyphicon-search'></span> </button>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <p><b>Search Results for :</b> <p style="color:green"><b id="searchText"></b></b></p></p>
                                </td>


                            </tr>

                            <tr>
                                <td>
                                    <div class="list-group" id="list" style="width: 430px">
                                        <div id="tabContainer">
                                            <table  class="table-hover" id="resultTab" style="word-break: break-all;">
                                                <tbody id="searchResults">
                                                </tbody>
                                            </table>
                                        </div>
                                        <div id="pager">
                                            <ul id="pagination" class="pagination-sm"></ul>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>


                    <div id="FacetsArea" class="tab-pane fade">
                        <table  style="margin-left: 15px" class="table-hover table-bordered" id="facetTab" style="word-break: break-all;">
                            <tbody id="facetResults" >
                            </tbody>
                        </table>
                    </div>

                </div>
            </td>
        </tr>
    </table>
</div>



<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content to show complete details of the paper-->
        <div class="modal-content" id="modalStyle">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Paper Details</h4>
            </div>
            <div class="modal-body">
                <table style="word-break: break-all;">
                    <tbody id="modalcontents" >

                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<!--<div class="mysuggestion" id="scholarlysuggestion">-->
    <ul id="suggestionBox" class="suggestionBoxscholarly">

    </ul>
<!--</div>-->


<div id="addTagModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-sm">
        <!-- Modal content-->
        <div class="modal-content" id="addTagstyle">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Rename Tab</h4>
            </div>
            <div class="modal-body">
                <input type="text" id="modalInput" autofocus>
            </div>

            <div class="modal-footer">
                <button type="submit" id="btnAddTag" onclick="changeTabName()">Rename</button>
                <button type="submit" id="btnCancel" onclick="CloseAddTagWindow()">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div id="showLimitedRecords" class="modal fade" role="dialog">
    <div class="modal-dialog modal-sm">
        <!-- Modal content-->
        <div class="modal-content" id="showLimitedRecordstyle">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" onclick="CancelLimitRecordsWindow()">&times;</button>
                <h4 class="modal-title" id="headerTitle"></h4>
            </div>
            <div class="modal-body">
                <table>
                    <tr>
                        <td>
                            <p id="totalRec">Total Records</p>
                            <input id="selectedIndexValue" autocomplete="off" type="hidden">
                        </td>
                        <td>
                            <b id="countofTotalRec"></b>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <p id="recDisplayedTitle">Records Displayed</p>
                        </td>

                        <td>
                            <b id="countofDisplayedRec"></b>
                        </td>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <p id="recEnteredTitle">Available Records</p>
                        </td>

                        <td>
                            <b id="countofAvailableRec"></b>
                        </td>
                        </td>
                    </tr>


                    <tr>
                        <td>
                            <p id="recInputTitle">Enter number of records to display </p>
                        </td>
                        <td>
                            <input type="text" id="recInput" onkeyup="checkValueEntered()" autofocus>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <p id="warningMsg" style="font-size: 11px; margin-top: 25px">*Please enter a non-negative number within total number of records available</p>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="modal-footer">
                <button type="submit" id="OKbtn" class="btn btn-primary" >OK</button>
                <button type="submit" id="Cancelbtn" class="btn btn-primary" onclick="CancelLimitRecordsWindow()">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div id="contextMenu" class="rename-menu">
    <ul>
        <li onclick="renameTab(clickedElement)">Rename</li>
       <!-- <li onclick="hideContextMenu()">Close</li>-->
    </ul>
</div>


<script src="../JS/HermesGraphLoader.js"></script>
<script src="../JS/Search.js"></script>
<script src="../JS/processAndFormEntities.js"></script>


<!--<div id="footer1" class="footerClass"></div>-->

<!-- This script is used for 2 purposes
1. To extract data from the input field  and use it as parameter for searchClicked() which is invoked in onload
2. Handle add and close tab functionality-->
<script>
    var clickedElement;
    var tabsClosedRecently=false;
    $(function () {
        $("#header1").load("Header.html");
        <!--$("#footer1").load("Footer.html");-->
        updateNodeAndEdgeCount();
    });



    //to obtain the value that was entered in search field which was passed through url
    var url_string = window.location.href;
    var url = new URL(url_string);
    var searchValue = url.searchParams.get("value");
    var typeValue=url.searchParams.get("type");
    //alert("in schol type= "+typeValue)

    $("#colResize").colResizable({
        liveDrag:true,
        gripInnerHtml:"<div class='grip'></div>",
        draggingClass:"dragging" });

    $(".workspaceTab").on("click", "a", function (e) {
        e.preventDefault();
        if (!$(this).hasClass('add-tab')) {
            $(this).tab('show');
            var elmnt = document.getElementById(e.currentTarget.attributes.href.nodeValue.replace("#",""));
            if(elmnt!==null){
                elmnt.scrollLeft = 250;
                elmnt.scrollTop = 600;
            }
        }

    })
        .on("click", "span", function () {
            if($(".workspaceTab li").length>2){
                var anchor = $(this).siblings('a');
                var indexofClosingTab=$(this).siblings("a")[0].getAttribute("href").substring(8,9);
                svg.splice(indexofClosingTab,1);
                force.splice(indexofClosingTab,1);
                authorAlreadyAdded.splice(indexofClosingTab,1);
                publicationAlreadyAdded.splice(indexofClosingTab,1);
                venueAlreadyAdded.splice(indexofClosingTab,1);
                coAuthorsAlreadyAdded.splice(indexofClosingTab,1);
                fosAlreadyAdded.splice(indexofClosingTab,1)
                instituteAlreadyAdded.splice(indexofClosingTab,1);
                processedArray.splice(indexofClosingTab,1);
                linksArray.splice(indexofClosingTab,1);
                paperWithCitationSeen.splice(indexofClosingTab,1);
                paperWithReferenceSeen.splice(indexofClosingTab,1);
                authorWithPublicationSeen.splice(indexofClosingTab,1);
                authorWithCoauthorshipSeen.splice(indexofClosingTab,1);
                coAtuthorIdsofAuthor.splice(indexofClosingTab,1);
                authorWithCitingNonCoauthorshipSeen.splice(indexofClosingTab,1);
                citingNoncoAtuthorIdsofAuthor.splice(indexofClosingTab,1);
                journalWithPublicationSeen.splice(indexofClosingTab,1)
                tabsClosedRecently=true;
                $(anchor.attr('href')).remove();
                $(this).parent().remove();
                $(".workspaceTab li").children('a').first().click();
            }
            else{
                alert("Minimum of one tab should be retained!!")
            }

        });


    $("#OKbtn").click(function(){
        $("#showLimitedRecords").modal('hide');
        var activetab=parseInt(getActiveTabIndex());
        var index=parseInt(document.getElementById("selectedIndexValue").innerText);
        if(document.getElementById("headerTitle").innerText==="Citations"){
            document.getElementById("OKbtn").style.cursor="wait";
           // document.getElementById("showLimitedRecords").style.zIndex=0;

            okOfCitationsClicked(activetab,index,processedArray[activetab]);
        }else if(document.getElementById("headerTitle").innerText==="References"){
            document.getElementById("OKbtn").style.cursor="wait";

            okOfReferencesClicked(activetab,index,processedArray[activetab]);
        }else if(document.getElementById("headerTitle").innerText==="Publications"){
            document.getElementById("OKbtn").style.cursor="wait";

            okOfPapersAuthoredClicked(activetab,index,processedArray[activetab]);
        }else if(document.getElementById("headerTitle").innerText==="Co-authorship"){
            document.getElementById("OKbtn").style.cursor="wait";

            okOfCoAuthorshipClicked(activetab,index,processedArray[activetab]);
        }else if(document.getElementById("headerTitle").innerText==="Citing non-coauthors"){
            document.getElementById("OKbtn").style.cursor="wait";

            okOfNonCoAuthorshipClicked(activetab,index,processedArray[activetab]);
        }else if(document.getElementById("headerTitle").innerText==="Papers Published"){
            document.getElementById("OKbtn").style.cursor="wait";

            okOfPapersPublishedClicked(activetab,index,processedArray[activetab]);
        }
    });

    window.onclick = hideContextMenu;
    function showContextMenu (event,element) {
        var contextMenu = document.getElementById('contextMenu');
        contextMenu.style.display = 'block';
        contextMenu.style.left = event.clientX + 'px';
        contextMenu.style.top = event.clientY + 'px';

         clickedElement=element;
        console.log(clickedElement)
        return false;
    }



    function hideContextMenu () {
        contextMenu.style.display = 'none';
    }

    $('.add-tab').click(function (e) {
        e.preventDefault();
        var id = $(".workspaceTab").children().length-1;

        if(id>10){
            alert("Sorry!! you cannot add more then 10 tabs");
        }
        else{
            var currentTab=getActiveTabIndex();

            var tabId = 'paperGraphArea' + id;
            $(this).closest('li').before('<li><a data-toggle="tab" oncontextmenu="return showContextMenu(event,this);" href="#tabArea' + id + '">New Tab</a> <span> x </span></li>');
            $('.tab-content').append('<div class="tab-pane fade" id="tabArea' + id +'" style="overflow: auto; height: 540px;"></div>');

            //document.getElementById("tabArea"+id).classList.add("active");
            var selector="#tabArea"+ id;

            if(!tabsClosedRecently) {
                svg[id] = d3.select(selector)
                    .append("svg")
                    .attr("id", tabId)
                    .attr("width", width)
                    .attr("height", height)
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                force[id] = d3.layout.force()
                    .distance(100)
                    .linkDistance([150])
                    .charge(-200)
                    .chargeDistance(1400)
                    .size([1300,1400])
                    .gravity(0.1)
                    .friction(0.8)
                    .alpha(0);
            }
            var ulItems=document.getElementsByClassName("workspaceTab");
            var liItems=ulItems[0].getElementsByTagName("li");
            var divElements=document.getElementsByClassName("tab-content");
            if(tabsClosedRecently){
                for(var i=0;i<liItems.length-1;i++){
                    var changedId="#tabArea"+i;
                    liItems[i].getElementsByTagName('a')[0].setAttribute("href",changedId);
                    divElements[0].getElementsByTagName("div")[i].setAttribute("id","tabArea"+i);
                }
                id = $(".workspaceTab").children().length-2;
                svg[id] = d3.select(selector)
                    .append("svg")
                    .attr("id", tabId)
                    .attr("width", width)
                    .attr("height", height)
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                force[id] = d3.layout.force()
                    .distance(100)
                    .linkDistance([150])
                    .charge(-200)
                    .chargeDistance(1400)
                    .size([1300,1400])
                    .gravity(0.1)
                    .friction(0.8)
                    .alpha(0);


                for(var j=0;j<divElements[0].getElementsByTagName("div").length;j++){
                    divElements[0].getElementsByTagName("div")[j].getElementsByTagName("svg")[0].setAttribute("id","paperGraphArea"+j);
                }
                tabsClosedRecently=false;
            }

            $('.workspaceTab li:nth-child(' + id + ') a').click();
            authorAlreadyAdded[id]=new Map();
            paperAlreadyAdded[id]=new Map();
            publicationAlreadyAdded[id]=new Map();
            venueAlreadyAdded[id]=new Map();
            coAuthorsAlreadyAdded[id]=new Map();
            fosAlreadyAdded[id]=new Map();
            instituteAlreadyAdded[id]=new Map();
            paperWithCitationSeen[id]=new Map();
            paperWithReferenceSeen[id]=new Map();
            authorWithPublicationSeen[id]=new Map();
            authorWithCoauthorshipSeen[id]=new Map();
            coAtuthorIdsofAuthor[id]=new Map();
            journalWithPublicationSeen[id]=new Map();
            authorWithCitingNonCoauthorshipSeen[id]=new Map();
            citingNoncoAtuthorIdsofAuthor[id]=new Map();

            processedArray[id]=[];
            linksArray[id]=[];
        }
    });



    function changeTabName(element) {
        var newName=document.getElementById("modalInput").value;
        if(newName.length>0){
            clickedElement.innerText=newName;
            CloseAddTagWindow()
        }else{
            alert("Tab name cannot be empty")
        }

    }

    function enableSlider() {
        if(document.getElementById("sliderChkbox").checked==true){
            document.getElementById("sliderValue").disabled=false;
            sliderEnabled=true;
            sliderMoved();
        }else{
            document.getElementById("sliderValue").disabled=true;
            node[getActiveTabIndex()].style("opacity",1);
            link[getActiveTabIndex()].style("opacity",1);
            sliderEnabled=false;
        }
    }

</script>
</body>
</html>